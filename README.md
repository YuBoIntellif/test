# 特征向量查找算法优化
该项目主要优化在一个N为特征向量的集合中找到一个与目标最相似的一个特性向量

# 使用方法
```
make       //构建之前，请安装好TBB环境，方法见后。
make test  //进行性能测试。
```

### 优化方法
| 序号 | 方法                                    |
|------|-----------------------------------------|
| 0    | 无                                      |
| 1    | 使用SIMD指令优化两个特征向量的比较方法。|
| 2    | 使用TBB优化查找操作。                   |
| 3    | 同时使用方法1和方法2。                  |

### 测试数据
1. 数据集 10000个， 测试10000次查找方法

| 算法   | 时间(s) |吞吐量(cps) | 加速比|
|--------|---------|------------|-------|
|普通    | 14.662  | 682        | 1x    |
|优化1   | 2.980   | 3355       | 4.8x  |
|优化2   | 3.042   | 3287       | 4.8x  |
|优化1+2 | 0.708   | 14124      | 20x   |


2. 数据集 100000个， 测试10000次查找方法

| 算法   | 时间(s) |吞吐量(cps) | 加速比|
|--------|---------|------------|-------|
|普通    | 78.040  |  128       | 1x    |
|优化1   | 20.827  | 480        | 3.75  |
|优化2   | 15.029  | 665        | 5.2x  |
|优化1+2 | 14.527  | 688        | 5.3x  |


3. 数据集 1000000个， 测试10000次查找方法

| 算法   | 时间(s) |吞吐量(cps) | 加速比|
|--------|---------|------------|-------|
|普通    | 155.017 | 64         | 1x    |
|优化1   |  43.993 | 227        | 3.5x  |
|优化2   |  32.721 | 305        | 4.7x  |
|优化1+2 |  33.489 | 298        | 4.6x  |

4. 数据集1000000个，测试100次查找方法
| 算法   | 时间(s) |吞吐量(cps) | 加速比|
|--------|---------|------------|-------|
|普通    | 14.669  | 7          | 1x    |
|优化1   |  4.456  | 22         | 3.5x  |
|优化2   |  3.463  | 28         | 4.7x  |
|优化1+2 |  3.437  | 29         | 4.6x  |

### Cache Miss情况
使用perf工具测量程序随数据规模增大而变化的情况。可以看到，当数据规模达到一定的
阈值后，Cache Miss陡然增大。
````
perf stat -e cache-references -e cache-misses ./normal_1 X
```
|数据大小(X)| Cache Miss|
|-----------|-----------|
|  1000     |  0.101  % |
|  10000    |  1.007  % |
|  12000    |  3.881  % |
|  15000    |  10.361 % |
|  20000    |  22.080 % |
|  100000   |  57.694 % |


### 相关软件包安装方法
1. 性能测试工具perf
```
apt-get install linux-tools-common linux-tools-generic linux-tools-`uname -r`

```
2. 性能测量工具
```
apt-get install valgrind
```

3. TBB
```
git clone https://github.com/01org/tbb.git
cd tbb
make
sudo make install
```

